<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, orientation=landscape">
    <title>Eye Gaze Tracking</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
        video {
            width: 640px;
            height: 480px;
        }
        #gazeDot {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: red;
            border-radius: 50%;
            z-index: 10;
        }
    </style>
</head>
<body>
    <video id="video" autoplay playsinline></video>
    <div id="gazeDot"></div>

    <script>
        const videoElement = document.getElementById('video');
        const gazeDot = document.getElementById('gazeDot');

        // Load MediaPipe FaceMesh
        const faceMesh = new FaceMesh({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`,
        });

        faceMesh.setOptions({
            maxNumFaces: 1,
            refineLandmarks: true,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5,
        });

        faceMesh.onResults((results) => {
            if (results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0) {
                const landmarks = results.multiFaceLandmarks[0];

                // Example of landmark indices for eyes
                const leftEye = landmarks[159]; // Example for left eye landmark
                const rightEye = landmarks[386]; // Example for right eye landmark

                // Convert landmarks to pixel coordinates
                const leftEyeX = leftEye.x * window.innerWidth;
                const leftEyeY = leftEye.y * window.innerHeight;

                const rightEyeX = rightEye.x * window.innerWidth;
                const rightEyeY = rightEye.y * window.innerHeight;

                // Place the gaze dot at the middle of both eyes as an approximation
                const gazeX = (leftEyeX + rightEyeX) / 2;
                const gazeY = (leftEyeY + rightEyeY) / 2;

                // Log coordinates for testing
                console.log(`GazeX: ${gazeX}, GazeY: ${gazeY}`);

                // Update the position of the gaze dot
                gazeDot.style.left = `${gazeX - 7}px`;
                gazeDot.style.top = `${gazeY - 7}px`;
            }
        });

        // Start the camera and run the face mesh model on every frame
        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await faceMesh.send({ image: videoElement });
            },
            width: 640,
            height: 480
        });

        camera.start();
    </script>
</body>
</html>